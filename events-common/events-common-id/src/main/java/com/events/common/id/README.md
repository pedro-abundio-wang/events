### ID generation

Each event/message has a 128-bit ID and it must be:

- Unique
- Monotonic constantly increasing, e.g. a consumer can detect duplicate events by comparing with the ID of last processed event from a given aggregate

Generation strategies:

- Application Generated ID: the producer generates the ID
- Database Generated ID: the database generates the ID, e.g. using auto incrementing columns

### Application Generated ID

This is the default strategy. IDs are generated by publisher. An application-generated ID consists of the following parts:

- 64 bits: the current time in milliseconds
- 16 bits: counter within milliseconds
- 48 bits: MAC address

The Application ID generation strategy is simple. But it has some drawbacks. 

The first drawback is that it relies on clocks being unsynchronized.

Imagine the following scenario where entity X is updated twice:

1. Entity X updated on server N at time T1 ==> event ID T1
2. Entity X updated on server M at time T2 ==> event ID T2

If the clocks are not synchronized, it’s possible that T2 < T1, which violates the requirement for monotonic IDs.

The second drawback is that multiple instances services are running on the same machine then by default they use the same MAC address, which results in non-unique IDs.

### Database Generated ID

The second and recommended strategy is database-generated IDs. This stategy uses database auto-generated IDs, e.g. MySQL auto-incrementing primary keys, or Postgres bigserial types.

A database generated ID has the following structure:

- 64 bits: DB generated ID, ie. an auto-incrementing column of the outbox (MESSAGE/EVENTS) table
- 16 bits: counter, used for internal needs, usually zero
- 48 bits: a unique Events outbox ID that identifies the outbox table

As you can see, a message ID is a combination of the primary key of the outbox table and the table’s Events outbox ID. The Events Outbox ID must be globally unique (within your application). You must configure all producers that insert messages/events into a given outbox table and the CDC reader that reads from that outbox with the same Events outbox ID.

You can activate database-generated ID support by setting USE_DB_ID to "true", changes the database schema by using auto-generated primary keys for the EVENTS and MESSAGE tables
